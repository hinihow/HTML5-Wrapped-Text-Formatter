<!DOCTYPE html>
<html lang="en-US">
<head>
  <title></title>
</head>
<body>
  <pre style="white-space: pre-wrap;" id="source" contenteditable="true" onclick="document.execCommand('selectAll',false,null);document.execCommand('copy')"></pre>
  <textarea id="originalSource" style="display: none"></textarea>
  <div id="google_translate_element"></div>
  <script type="text/javascript">
let isOK = false
function ok() {
  isOK = true
}

function setGoogleTransCookie() {
  if (document.cookie === '') {
    document.cookie = "googtrans=/en/zh-TW";
  }
}

function googleTranslateElementInit() {
  if (isOK === false) {
    setTimeout(() => {
      googleTranslateElementInit()
    }, 1000)
    return
  }

  setGoogleTransCookie()

  new google.translate.TranslateElement({
    //pageLanguage: 'en',
    autodisplay: false,
    layout: google.translate.TranslateElement.FloatPosition.TOP_LEFT
  }, 'google_translate_element');
  callbackToOpener()
}
function callbackToOpener() {
  setTimeout(function () {
    let output = $('#source').text()
    let originalSource = $('#originalSource').val()

    if (output === originalSource) {
      if ($('.goog-te-combo').val().trim() === '') {
        $('.goog-te-combo').val('zh-TW')
        $('.goog-te-combo').change()
        $('.goog-te-combo').click()
        $('.goog-te-combo').mouseleave()
        $('.goog-te-combo').mouseover()
        console.log($('.goog-te-combo').val())
      }
      callbackToOpener()
      return
    }

    let note = window.top.$(window.top.document.body).find('.wait-trans')
    note.val(output)
    note.trigger("autosize.resize")
    note.focus()
    note.removeClass('wait-trans')
    //window.close()
    location.reload()
  }, 500)
}
</script>

<script type="text/javascript" src="jquery.min.js"></script>
<script type="text/javascript" src="//translate.google.com/translate_a/element.js?cb=ok"></script>

</body>
</html>
